

# virtualenv
* Windows
```bash
    pip install virtualenv
    python -m virtualenv <virtual_name>

    .\\venv\Scripts\activate 
```

# django
## settings.py
* > django 3.1:
  ```
  BASE_DIR = Path(__file__).resolve().parent.parent
  STATIC_ROOT = BASE_DIR/'static'
  ```

## start django project

```bash
    pip install django
    #powershell
    django-admin startproject <project_name>

    # inside the project directory
    python manage.py runserver
```

## MVT
* model view template
  * model: define the data for your application and abstraction layer
  * view: the logic for your application 
    * function-based view
    * class-based view
      * compared with function-based view, fewer lines of code need to be used
      * inherit Django's generic views
  * template: HTML files

## Structure of directories
### Django Project
|   Files   | Meaning               |
|:---------:|:----------------------|
| manage.py | manage django project |

#### manage.py
* ``python3 manage.py <code>``

|      Code      | Meaning                                                                                                                                                                        | Example                                                 |
|:--------------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------|
|   runserver    | start the HTTP server. Automatically restart in the terminal when scripts change. Except for database changes                                                                  | runserver (host:)port                                   |
|    startapp    | create a new Django app                                                                                                                                                        |
|     shell      | start a Python interpreter                                                                                                                                                     | python manage.py shell                                  |
|    dbshell     | start an interactive shell connected to database                                                                                                                               |
| makemigrations | generate database change instructions from model definitions => help identify any changes to the models and will propagate these changes into the database while the migration | python manage.py makemigrations <app_folder>            | 
| showmigrations | see the migration status                                                                                                                                                       | python manage.py showmigrations                         |
|   sqlmigrate   | see the process how Django transforms a model into an actual database table                                                                                                    | python manage.py sqlmigrate <app_folder> <migrate_file> |
|    migrate     | actually apply migrations generated by the makemigrations                                                                                                                      | python manage.py migrate <app_folder>                   | 
|      test      | run automated tests                                                                                                                                                            |

##### shell
* advantage: no need to maintain sql script

```python
from reviews.models import Publisher
publisher = Publisher(name='...', website='...', email='...')

# write the object into the database
publisher.save()

# see the object attributes
publisher.email

# change the object 
publisher.email = '...'

# create an object in a single step
from reviews.models import Contributor
contributor = Contributor.objects.create(first_names='Rowel', last_names='Atienza', email='RowelAtienza@example.com') 


# get object
from reviews.models import Publisher
publisher = Publisher.objects.get(name='PacktPublishing') 

## primary key or id
publisher = Publisher.objects.get(pk=2) 
publisher = Publisher.objects.get(id=2)

# all(): retrieve all the objects -> return QuerySet
contributors = Contributor.objects.all()
## get specific object
contributors[0] # because of QuerySet
contributors[0].first_names

# create an object with foreign object
book = Book.objects.create(title='...', publication_date='...', isbn='...', publisher=publisher)

# many-to-many relationships
book = Book.objects.get(title='Advanced Deep Learning with Keras')
contributor = Contributor.objects.get(first_names='Rowel')
book_contributor = BookContributor(book=book, contributor=contributor, role='AUTHOR') 

## add: only one object - no need to use the relationship to connect objects
book.contributors.add(contributor, through_defaults={'role': 'EDITOR'}) 

## create non-present & non-relational object in the database
book.contributors.create(first_names='Packtp', last_names='Editor Example', email='PacktEditor2@example.com', through_default
s={'role': 'EDITOR'})

## set: add a list of contributors for a book
contributor1 = Contributor.objects.create(first_names='Stephen', last_names='Stephen', email='StephenKing@example.com')
contributor2 = Contributor.objects.create(first_names='Peter', last_names='Straub', email='PeterStraub@example.com') 
book = Book.objects.create(title='The Talisman', publication_date=date(2012, 9, 25), isbn='9781451697216', publisher=publishe
r)
book.contributors.set([contributor1, contributor2], through_defaults={'role': 'CO_AUTHOR'})

# filter
Contributor.objects.filter(first_names='Peter')

## greater than
book = Book.objects.filter(publication_date__gt=date(2014, 1, 1))
## less than: lt
## less than or equal to: lte
## greater than or equal to: gte
## string contain: contains
## exclude: exclude
### chains of query
Book.objects.filter(publication_date__gt=date(2014, 1, 1)).filter(...)



# order: order_by
## descending:
Book.objects.order_by('-title')

# get dictionaries instead of objects
publishers = Publisher.objects.all().values()

# query data with relationships
## query by foreign key: __
Book.objects.filter(publisher__name='Packt Publishing')
## query by model name in lowercase
Publisher.objects.get(book__title='..')
## query by object instance: set.all()
book = Book.objects.get(title='') # optional
publisher = Publisher.object.get(name='')
publisher.book_set.all()

# filter + update/delete
Contributor.objects.filter(last_names='...').update(first_names='')



```


#### <project> directory
* next to ``manage.py``

|    File     | Meaning                     |
|:-----------:|:----------------------------|
| __init__.py | indicate python module      |
|   urls.py   | global URL mappings         |
| settings.py | django settings             |
|   asgi.py   | communicate with Django App |
|   wsgi.py   | communicate with Django App |

##### Settings.py
* global variables
> Do not use/import self-created settings file. Use **django.conf** or settings will be affected by
> 1. other different settings.py file
> 2. Hidden settings of Django
> 3. Third-party libraries settings

> if one setting variable is missing, the value will fall back to the default value of Django
> 
> If using self-created settings files, the value will not fall back

|    variable    | Meaning                                                                                  |
|:--------------:|:-----------------------------------------------------------------------------------------|
|   SECRET_KEY   | for hashing, tokens, cryptographic functions                                             |
|     DEBUG      | True: automatically display exceptions to browser. If production, it should be set False |
| INSTALLED_APPS | Django third-party apps                                                                  |
|  ROOT_URLCONF  | Django loads first to find URLs. index view URL map                                      |
|   TEMPLATES    ||
|    APP_DIRS    | look in a templates directory inside each INSTALLED_APP when loading templates           |




### django app
|    File     | Meaning                                                                         |
|:-----------:|:--------------------------------------------------------------------------------|
| __init__.py | indicate python module                                                          |
|  admin.py   | built-admin site for viewing and edition data with GUI                          |
|   apps.py   | configuration for the metadata of app                                           |
|  models.py  | define the models for applications. Each model transforms into a database table |
| migrations  | automatically record changes to database. generated when running manage.py      | 
|  tests.py   | test code                                                                       |
|  views.py   | django views                                                                    |


## QueryDict Object
* immutable
  * require `copy` to edit the object
```python
qd = QueryDict('k=a&k=b&k=c')
qd['k'] # c
qd.get('k') #c
qd.getlist('k') # ['a', 'b', 'c']
qd.getlist('g') # []
```

```python
qd2 = qd.copy()
qd2['k'] = 'd'
qd2['k'] # change c -> d  
```
> Note: 
>
> name = request.GET.get('name', 'world') => empty value if name=""
> use name = request.GET.get('name') or 'world'

## Functions

### Render
* a shortcut function that returns an HttpResponse instance
* two arguments
  * request
  * name/relative path of the template being rendered
  * (optional) render context containing variables available in the template


## ORM
* convert object-oriented Python code into actual database constructs
* advantage: avoid sql injection
### Migration
* transformation of Python code into database structures

# HTTP status
| Status  | Meaning                                           |
|:-------:|:--------------------------------------------------|
| 100-199 | protocol changes, more data is requires. No worry |
| 200-299 | successful                                        |
| 300-399 | redirect response                                 |
| 400-499 | error on client side                              |
| 500-599 | error on server side                              |


# URL Path
* Project root url
  * settings.py: ROOT_URLCONF
  * determine the URL configuration file to be used first
* include:
  * on django project level 
  * a shortcut that allows you to combine URL configurations 
    * a project has many application. each application has their own URL configurations


# Template
* no need to hardcode template
  * settings.py: TEMPLATES

| Variable | Meaning                                                                                                          |
|:--------:|:-----------------------------------------------------------------------------------------------------------------|
| BACKEND  | the template engine Django uses to work with HTML templates. default - DjangoTemplates                           |
|   DIRS   | the directories where Django searches for the templates. If empty, search for templates under each app directory |                                |
| APP_DIRS | True: look for templates in the installed apps under INSTALLED_APPS (settings)                                   |
| OPTIONS  | template engine-specific settings e.g. context processors                                                        |

## Template Language
### Template Variables
* value carried by the variables will be replaced in the template
```commandline
  {{ variable }}
```

### Template Tags
* for control flow, like if else or for loop
```commandline
  {% for element in element_list %}
    ...
  {% endfor %}
```

### Comments

```commandline
  {% comment %}
    ...
    
  {% endcomment %}
```
### Filters

```commandline
 {{ variable|<filter> }}    
```
* `<filter>`: 
  * lower: convert string into lowercase
  * title: convert string into capital

## Template Inheritance
* 
